{"version":3,"file":"findPriorTimelineSiblings.js","sourceRoot":"","sources":["../../src/daimon/findPriorTimelineSiblings.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,WAAW,EAAE,SAAS,EAAE,MAAM,oBAAoB,CAAC;AAC5D,OAAO,EAAE,KAAK,EAA0B,MAAM,gCAAgC,CAAC;AAC/E,OAAO,EAAE,gBAAgB,EAAE,MAAM,oBAAoB,CAAC;AAEtD,OAAO,EAAE,mBAAmB,EAAE,MAAM,uBAAuB,CAAC;AAE5D,OAAO,EAAE,iBAAiB,EAAa,MAAM,cAAc,CAAC;AAE5D,+EAA+E;AAE/E,MAAM,CAAC,MAAM,yBAAyB,GACpC,CAA8B,GAAiC,EAAE,EAAE,CACnE,KAAK,EAAE,MAAe,EAA0B,EAAE;IAChD,IAAI,WAAW,CAAC,MAAM,CAAC,EAAE,CAAC;QACxB,OAAO,EAAE,CAAC;IACZ,CAAC;IAED,MAAM,IAAI,GAAG,CAAC,MAAM,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAO;QACvC,WAAW,EAAE,iBAAiB;QAC9B,GAAG,EAAE,MAAM;KACZ,CAAC,CAAS,CAAC;IACZ,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI,EAAE,CAAC;IAChC,IAAI,WAAW,CAAC,QAAQ,CAAC,EAAE,CAAC;QAC1B,OAAO,EAAE,CAAC;IACZ,CAAC;IACD,MAAM,kBAAkB,GAAG,CAAC,MAAM,mBAAmB,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACvE,IACE,WAAW,CAAC,kBAAkB,CAAC;QAC/B,WAAW,CAAC,kBAAkB,CAAC,OAAO,CAAC,EACvC,CAAC;QACD,OAAO,EAAE,CAAC;IACZ,CAAC;IACD,MAAM,QAAQ,GAAG,MAAM,gBAAgB,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC;IAEvD,MAAM,mBAAmB,GAAG,MAAM,mBAAmB,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC;IACrE,MAAM,MAAM,GAAG,mBAAmB,CAAC,MAAM,CACvC,CAAC,OAAO,EAAE,EAAE,CACV,CAAC,OAAO,EAAE,OAAO,EAAE,SAAS,IAAI,CAAC,CAAC;QAClC,CAAC,kBAAkB,CAAC,OAAO,EAAE,SAAS,IAAI,CAAC,CAAC,CAC/C,CAAC;IACF,MAAM,cAAc,GAAG,kBAAkB,CAAC,IAAI,CAAC,QAAQ,CAAC;IACxD,MAAM,wBAAwB,GAAG,SAAS,CAAC,cAAc,CAAC;QACxD,CAAC,CAAC,MAAM,yBAAyB,CAAC,GAAG,CAAC,CAAC,cAAc,CAAC;QACtD,CAAC,CAAC,EAAE,CAAC;IAEP,OAAO,CAAC,GAAG,MAAM,EAAE,kBAAkB,EAAE,GAAG,wBAAwB,CAAC,CAAC;AACtE,CAAC,CAAC","sourcesContent":["import { isUndefined, isDefined } from \"@mjt-engine/object\";\nimport { Datas, type DataConnectionMap } from \"@mjt-services/data-common-2025\";\nimport { findRoomChildren } from \"./findRoomChildren\";\nimport type { RoomContent } from \"../type/RoomContent\";\nimport { roomsToRoomContents } from \"./roomsToRoomContents\";\nimport type { MessageConnectionInstance } from \"@mjt-engine/message/dist/createConnection\";\nimport { ROOM_OBJECT_STORE, type Room } from \"../type/Room\";\n\n/** think stairsteps, this is rooms _above_ the current room in the timeline */\n\nexport const findPriorTimelineSiblings =\n  <M extends DataConnectionMap>(con: MessageConnectionInstance<M>) =>\n  async (roomId?: string): Promise<RoomContent[]> => {\n    if (isUndefined(roomId)) {\n      return [];\n    }\n\n    const room = (await Datas.get(con)<Room>({\n      objectStore: ROOM_OBJECT_STORE,\n      key: roomId,\n    })) as Room;\n    const { parentId } = room ?? {};\n    if (isUndefined(parentId)) {\n      return [];\n    }\n    const currentRoomContent = (await roomsToRoomContents(con)([room]))[0];\n    if (\n      isUndefined(currentRoomContent) ||\n      isUndefined(currentRoomContent.content)\n    ) {\n      return [];\n    }\n    const siblings = await findRoomChildren(con)(parentId);\n\n    const siblingRoomContents = await roomsToRoomContents(con)(siblings);\n    const priors = siblingRoomContents.filter(\n      (sibling) =>\n        (sibling?.content?.createdAt ?? 0) <\n        (currentRoomContent.content?.createdAt ?? 0)\n    );\n    const parentParentId = currentRoomContent.room.parentId;\n    const parentParentRoomContents = isDefined(parentParentId)\n      ? await findPriorTimelineSiblings(con)(parentParentId)\n      : [];\n\n    return [...priors, currentRoomContent, ...parentParentRoomContents];\n  };\n"]}